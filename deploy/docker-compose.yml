version: "3.9"
services:
  mail:
    image: bytemark/smtp
    restart: always

  nginx:
    build: ./nginx/
    restart: always
    volumes:
      - gunicorn_run:/run/gunicorn/
      - web_static:/var/www/bookkeeper/static/:ro
      - ../${APP_DATA_STORAGE}/media:/var/www/bookkeeper/media/:ro
    ports:
      - "8888:80"
    depends_on:
      - django
    environment:
      - EMAIL_HOST=mail
      - EMAIL_HOST_PASSWORD=
      - EMAIL_HOST_USER=
      - EMAIL_PORT=25
      - EMAIL_USE_SSL=1

  django:
    build:
      context: ../
      dockerfile: ./deploy/web/Dockerfile
    restart: always
    volumes:
      - ../${APP_DATA_STORAGE}/media:/var/www/bookkeeper/media
      - ../${APP_DATA_STORAGE}/db:${APP_DATA_LOCATION}/db/
      - gunicorn_run:/run/gunicorn/
      - web_static:/var/www/bookkeeper/static

volumes:
  gunicorn_run:
  web_static:
